MEMO 27-03-2023

The Essence parser is coming along, it is still a rough prototype.
Currently we parse:
letting and find. Both constants and domains (named and implicit) for:
- int
- tuples
- relations

Named domains are stored in a dictionary. This means that at this point in time named domains have to be declared before using them, but it could be changed easily.
There is no type-checking. 

Arithmetic expressions and inequalities with operator precedence seem to work correctly.
Next in-line features (taken care by Chris):
- Quantifiers: forAll and exists
- Expression concatenation with " . "


After some brainstorming, we decided to boil down the structure of the Abstract Syntax Tree to its minimal normalised structure. At the moment, due to the way we construct the graph, it may turn into an Abstract Syntax Graph(DAG) with a bit of syntactic sugar still around. This could cause some complications. One of the reasons is that minimal essential structure will make rewriting rules simpler.

Something that was discussed is how to go back from AST to proper Essence.
There are two candidate approaches:
- Inverse-parsing rules. Each parsing rule basically describes how to add back all the parenthesis, commas and so on. There are many and it will be very verbose, but very easy to write.
- Extra rewriting rules. Basically, in the same way we change the spec we can add all the Essence syntactic sugar in the right places post-model transformation. This operation has already been named "Icing". There is some aesthetic beauty to this approach. Possibly easy?

The above will be decided at the next iteration.

Normalisation rules that will be implemented first:
- Small blob before large blob (via node degree or subtree size)
- Small numbers before large
- Lexicographic (alphabetic a->z)
- Equalities before inequalities

Regarding the actual rewriting, the next-in-line test will investigate GP2 (taken care of by Andras), a graph transformation program and language developed in York.
First we will look at basic arithmetic rewriting and De Morgan transformations.
